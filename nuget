# Azure Pipelines YAML
trigger:
  branches:
    include:
      - main

pool:
  vmImage: 'windows-latest'

steps:
- task: PowerShell@2
  displayName: 'Install NuGet'
  inputs:
    targetType: 'inline'
    script: |
      # Create destination folder
      $nugetFolderPath = 'C:\nuget'
      New-Item -ItemType Directory -Force -Path $nugetFolderPath

      # Download NuGet.exe
      $nugetUrl = 'https://dist.nuget.org/win-x86-commandline/latest/nuget.exe'
      $nugetPath = Join-Path -Path $nugetFolderPath -ChildPath 'nuget.exe'
      Invoke-WebRequest -Uri $nugetUrl -OutFile $nugetPath -UseBasicParsing

      # Add NuGet.exe to PATH for the current process
      $envPath = [Environment]::GetEnvironmentVariable('PATH', 'Process')
      $newPath = "$envPath;$nugetFolderPath"
      [Environment]::SetEnvironmentVariable('PATH', $newPath, 'Process')

- script: |
    nuget sources add -name "NuGet.org" -source "https://api.nuget.org/v3/index.json" -configfile "$(Build.SourcesDirectory)/NuGet.config"
  displayName: 'Add NuGet.org as package source'

- script: |
    nuget restore "$(Build.SourcesDirectory)/YourSolution.sln" -NonInteractive -IgnoreSSL
  displayName: 'Restore NuGet packages'
